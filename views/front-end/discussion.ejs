<%- include('common/header') -%>
<link href="/front-end/css/discussion-style.css" rel="stylesheet" type="text/css">
<%- include('common/header-banner') -%>

<!-- ============== Section1 Start =============== -->
<section class="main-content bottom-main-content">
  <div class="discussion-page-content">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
            <div class="discussions-left">
                <div class="text-end">
                <span class="language-select">
                    <span class="lang-change">Everything</span> <a href="" class="lang-arw"><i class="fa-solid fa-sort"></i></a>
                    <div class="lang-dropdown">
                        <ul class="p-0 m-0">
                        <li><a href="">Everything</a></li>
                        <li><a href="">Top</a></li>
                        <li><a href="">New</a></li>
                        </ul>
                    </div>
                </span>  
                </div>
                <div id="horizontalTab">
                <ul class="resp-tabs-list">
                    <li>Recent</li>
                    <li>Top</li>
                    <li>Newest</li>
                    <li>Eldest</li>
                    <li>Popular</li>
                </ul>
                <div class="resp-tabs-container">
                    <div class="tab-content-wrap">
                        <% if(AllLatestDiscussion.length > 0) { %>
                        <% AllLatestDiscussion.forEach((LatestDiscussion)=>{  %>
                        <div class="discussion-review-panel">
                            <a href="/discussion-details/<%= LatestDiscussion.id %>">
                                <div class="discussion-user-img">
                                <!-- <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60"> -->
                                <h4><%= LatestDiscussion.topic.charAt(0).toUpperCase()  %></h4>
                                </div>
                                <div class="discussion-user-info">
                                <h4><%= LatestDiscussion.topic %> / <%= LatestDiscussion.topic.charAt(0).toUpperCase()  %>
                                </h4>
                                <% const date = new Date(LatestDiscussion.created_at); %>
                                <p>Created <%= date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) %> by <%= LatestDiscussion.first_name %> <%= LatestDiscussion.last_name %></p>
                            
                                </div>
                                <div class="dis-comment-views">
                                <span>29 Comments</span>
                                <span>100views</span>
                                </div>
                            </a>
                        </div>
                        <% }) %>
                        <% } %>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <!-- <div class="text-center mt-md-5 mt-4">
                            <a href="#" class="btn-default btn-warning discussion-load-btn">Load More</a>
                        </div> -->
                    </div>
                    <div class="tab-content-wrap">
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <!-- <div class="text-center mt-md-5 mt-4">
                            <a href="#" class="btn-default btn-warning discussion-load-btn">Load More</a>
                        </div> -->
                    </div>
                    <div class="tab-content-wrap">
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <!-- <div class="text-center mt-md-5 mt-4">
                            <a href="#" class="btn-default btn-warning discussion-load-btn">Load More</a>
                        </div> -->
                    </div>
                    <div class="tab-content-wrap">
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <!-- <div class="text-center mt-md-5 mt-4">
                            <a href="#" class="btn-default btn-warning discussion-load-btn">Load More</a>
                        </div> -->
                    </div>
                    <div class="tab-content-wrap">
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <div class="discussion-review-panel">
                            <div class="discussion-user-img">
                            <img src="../front-end/images/user-img.jpg" alt="img" width="60" height="60">
                            </div>
                            <div class="discussion-user-info">
                            <h4>Lorem Ipsum</h4>
                            <p>Created 5 days ago by Lorem Ipsum</p>
                            </div>
                            <div class="dis-comment-views">
                            <a href="#">29 Comments</a>
                            <a href="#">100views</a>
                            </div>
                        </div>
                        <!-- <div class="text-center mt-md-5 mt-4">
                            <a href="#" class="btn-default btn-warning discussion-load-btn">Load More</a>
                        </div> -->
                    </div>
                </div>
                </div>
            </div>
            </div>
            <div class="col-md-4">
            <div class="discussions-right mt-md-0 mt-4">
                <div class="search-area position-relative">
                    <form>
                        <input type="text" class="form-control" placeholder="Search" required="">
                    </form>
                    <input type="submit" value="Search">
                    <div class="autofield-dropdown">
                        <ul class="p-0 m-0">
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        <li><a href="#">Nunc non posuere justo erat semper enim</a></li>
                        </ul>
                    </div>
                </div>
                <div class="discussions-right-panel">
                <h4>Popular Discussions</h4>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    78
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    50
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    33
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    42
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    12
                    </div>
                </div>
                </div>
                <div class="discussions-right-panel">
                <h4>Popular Showcase</h4>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    78
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    50
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    33
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    42
                    </div>
                </div>
                <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                    <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                    12
                    </div>
                </div>
                </div>
                <div class="discussions-right-panel">
                    <h4>New Showcase</h4>
                    <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                        <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                        78
                    </div>
                    </div>
                    <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                        <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                        50
                    </div>
                    </div>
                    <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                        <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                        33
                    </div>
                    </div>
                    <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                        <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                        42
                    </div>
                    </div>
                    <div class="dis-right-panel-item">
                    <div class="dis-r-panel-item-left">
                        <a href="#"><i class="fa-regular fa-arrow-right-long"></i>Lorem Ipsum</a> 
                    </div>
                    <div class="dis-r-panel-item-right">
                        12
                    </div>
                    </div>
                </div>
                <div class="discussions-right-panel">
                    <h4>Popular Tags</h4>
                        <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a> <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a> <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a> <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a> <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a> <a href="#" class="btn-default btn-warning pop-tag-btn">Lorem Ipsum</a>
                </div>
                <% if(currentUserData){ %>
                <div class="start-a-discussion-btn text-center">
                    <a href="#" class="btn-default btn-dark" data-bs-toggle="modal" data-bs-target="#creatediscussion"><i class="fa-solid fa-pen-to-square"></i> Start A Discussion</a>
                </div>
                <% } %>
            </div>
            </div>
        </div>
        </div>
    </div>
  </section>

  <!-- The Modal -->
<div class="modal fade" id="creatediscussion">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
            <h2>Create Discussion</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          <form id="create_discussion_form">
            <div id="sendreviewtags" class="custom-form">
                <label style="background-color: #ffffff;">Tags</label>
                <input type="text" name="tags" placeholder="Add tag" data-gtm-form-interact-field-id="0">
             </div>
             <div class="custom-form">
                <label><span style="background-color: #ffffff;">Message</span></label>
                <textarea name="topic" id="" class="form-control mb-4"></textarea>
             </div>
             <% const date = new Date(); %>
            <%
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
            %>
            <div class="row">
                <div class="col-sm-6">
                    <div class="custom-form">
                        <label><span style="background-color: #ffffff;">From</span></label>
                        <input type="date" class="form-control" name="from_data" value="<%= formattedDate %>" placeholder="" style="pointer-events: none;">
                    </div>
                </div>
                <%
                    const nextyear = date.getFullYear() + 1; // Add 1 to the current year
                    const nextmonth = String(date.getMonth() + 1).padStart(2, '0');
                    const nextday = String(date.getDate()).padStart(2, '0');
                    const nextYearDate = `${nextyear}-${nextmonth}-${nextday}`;
                %>
                <div class="col-sm-6">
                    <div class="custom-form">
                        <label><span style="background-color: #ffffff;">To</span></label>
                        <input type="date" class="form-control" name="expire_date" value="<%= nextYearDate%>" style="padding-right: 18px;">
                    </div>
                </div>
            </div>
            <% if(currentUserData){ %>
            <div class="custom-form mb-sm-0">
                <input type="hidden" name="user_id" value="<%= currentUserData.user_id %>" />
                <input type="submit" class="btn-default btn-warning" value="Submit">
            </div>
            <% } %>
          </form>
        </div>
        <div class="register-now frm-loading" style="display: none;">
            <span class="indicator-progress">Please wait...
               <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
            </span>
         </div>
         <div style=" width: 100%; text-align: center; display: block; border: 2px solid #fccb06; padding: 6px; margin-top: 20px; border-radius: 5px; display: none;" class="response-message"></div>
      </div>
    </div>
  </div>

<!-- ============== Section1 End =============== -->

<%- include('common/footer') -%>   

<script>
    $(document).ready(function () {
        var allTags = [];
        var transformedResponse = {};
        $('form#create_discussion_form').submit(function (e) {
          e.preventDefault();
          $('.response-message').hide();
          $('.response-message').text('');
          $('#invitation_email').prop('disabled', true);
          $('.frm-loading').show(); 
          //alert('aaaaaa')
          $(this).find('#sendreviewtags').find('span').each(function(){
             var enteredTag= $(this).text();
             allTags.push(enteredTag);
          });
            const formData = $('#create_discussion_form').serializeArray();
            $(formData).each(function (index, field) {
                transformedResponse[field.name] = field.value;
            });
          transformedResponse['tags'] = allTags;
          console.log(transformedResponse);
            //return false;
          
            $.ajax({
            url: '/auth/create-discussion', // URL for your API endpoint
            method: 'POST',
            data: JSON.stringify(transformedResponse),
            processData: false,
            contentType: 'application/json',
            success: function (data) {
                if (data.status == 'ok') {
                    $('.response-message').text(data.message);
                    $('.response-message').show();
                    $('#invitation_email').prop('disabled', false);
                    $('.frm-loading').hide();
                    setTimeout(function() {
                        window.location.reload();
                    }, 2000);
                } else {
                    $('.response-message').text(data.message);
                    $('.response-message').show();
                    $('#invitation_email').prop('disabled', false);
                    $('.frm-loading').hide();
                    console.log('Something went wrong');
                }
            },
            error: function (xhr, status, error) {
                // Handle any errors that occur during the request
                console.log(error);
            }
        });
    
          
       });
    });
    </script>