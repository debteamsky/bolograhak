<%- include('common/header') -%>
    <link href="/front-end/css/company-profile-dashboard.css" rel="stylesheet" type="text/css">
    <link href="/front-end/css/business-profile-manage-style.css" rel="stylesheet" type="text/css">
    <%- include('common/header-banner') -%>

        <!-- ============== Section1 Start =============== -->
        <section class="main-content about-content2 py-3">
            <div class="container">
                <div class="company_profile_management">

                    <div class="basic_info_of_company">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <div class="company_logo">
                                <a href="#"><img src="/front-end/images/feature-logo1.png" alt="samsung"></a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="company_details">
                                <div class="row">
                                <div class="col-sm-12">
                                    <h2 class="company_name">Company Name</h2>
                                </div>
                                <div class="col-sm-6">
                                    <p class="common_style"><i class="fas fa-envelope"></i><a
                                            href="mailto:johndoe12@gmail.com">johndoe12@gmail.com</a></p>
                                </div>
                                <div class="col-sm-6">
                                    <p class="common_style"><i class="fas fa-mobile"></i><a
                                            href="tel:+9876543210">+9876543210</a></p>
                                </div>
                                <div class="col-sm-12">
                                    <p class="common_style"><i class="fas fa-map-marker-alt"></i> EE 91, EE Block, Sector
                                        II, Bidhannagar, Kolkata, West Bengal 700091</p>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="overall_score">
                                <div class="button_group">
                                <a class="free" href="#">Free</a>
                                <a class="switch_to_premium" href="#">switch to premium</a>
                                </div>
                                <div class="score_info">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="review_count">4.5</div>
                                    <div class="emoji_respective_review">
                                        <img src="/front-end/images/4-5.gif" alt="">
                                    </div>
                                </div>
                                <p>Total Review 1,117</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="company_profile_navigation">
                        <ul>
                            <li><a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                            <li><a href="#"><i class="fas fa-envelope"></i> My Reviews</a></li>
                            <li class="active">
                                <a href="#"><i class="fas fa-user-tie"></i> Profile</a>
                                <ul>
                                    <li><a href="#">User Profile</a></li>
                                    <li><a href="#">Company Profile</a></li>
                                </ul>
                            </li>
                            <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
                            <li><a href="#"><i class="fas fa-lock"></i> Change Password</a></li>
                            <li><a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </div>
                    <form id="premium_company_profile_form" enctype="multipart/form-data">
                        <input type="hidden" name="company_id" value="<%= company.ID  %>"/>
                        <input type="hidden" name="previous_logo" value="<%= company.logo %>"/>
                        <div class="each_box update_basic_information">
                            <h2>Basic informations</h2>
                            <div class="row align-items-center mb-3">
                                <div class="col-sm-7 col-md-8 col-lg-10">
                                    <label for="upload-company-logo" class="form-label">Upload logo</label>
                                    <input class="form-control" type="file" id="upload-company-logo" name="logo">
                                </div>
                                <div class="col-sm-5 col-md-4 col-lg-2">
                                    <div class="display_image_box">
                                        <% if(company && company.logo) { %>
                                        <img id="company_logo_preview" src="/<%= company.logo %>"  alt="">
                                        <%} else {%>
                                            <img id="company_logo_preview" src="/front-end/images/company-placeholder-image.png"  alt="">
                                            <% } %>
                                    </div>
                                </div>
                            </div>
                            <div class="row align-items-center mb-3">
                                <div class="col-sm-7 col-md-8 col-lg-10">
                                    <label for="upload-company-coverimage" class="form-label">Upload cover
                                        image</label>
                                    <input class="form-control" type="file" id="upload-company-coverimage" name="cover_image">
                                </div>
                                <div class="col-sm-5 col-md-4 col-lg-2">
                                    <div class="display_image_box">
                                        <img id="company_cover_image_preview" src="/front-end/images/fixed-emoji.png"
                                            alt="">
                                    </div>
                                </div>
                            </div>
                            <div class="row align-items-center">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="company-email" class="form-label">Email<sup>*</sup></label>
                                        <input type="email" class="form-control" id="company-email"
                                            placeholder="name@example.com" value="<%= company && company.comp_email ? company.comp_email : '' %>" name="comp_email" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="company-phone-number" class="form-label">Phone no<sup>*</sup></label>
                                        <input type="number" class="form-control" id="company-phone-number"
                                            placeholder="1234567890" value="<%= company && company.comp_phone ? company.comp_phone : '' %>" name="comp_phone" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="company-customercare-number" class="form-label">Customer care
                                            no</label>
                                            <input type="number" class="form-control" id="company-customercare-number"
                                                placeholder="1800 0000 00" value="<%= company && company.tollfree_number ? company.tollfree_number : '' %>" name="tollfree_number" >
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="company-address" class="form-label">Address<sup>*</sup></label>
                                        <input type="text" class="form-control" id="company-address" value="<%= company && company.main_address ? company.main_address : '' %>" name="main_address" placeholder=""
                                            required>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="about-company" class="form-label">About the company<sup>*</sup></label>
                                        <textarea class="form-control" id="about-company" placeholder="" rows="5" name="about_company"
                                            required><%= company && company.about_company ? company.about_company : '' %></textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="company-tagline" class="form-label">Tagline</label>
                                        <input type="text" class="form-control" id="company-tagline" placeholder="Tagline" value="<%= company && company.heading ? company.heading : '' %>" name="heading">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="each_box update_gallery_images">
                            <h2 class="mb-3">Upload gallery images</h2>
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="upload-gallery-img" class="form-label">Choose Images</label>
                                        <input type="file" class="form-control" name="gallery_images" multiple
                                            id="upload-gallery-img" />
                                    </div>
                                    <div id="imagePreview" class="row"></div>
                                </div>
                            </div>
                        </div>
                        <div class="each_box update_youtuve_videos">
                            <h2 class="mb-3">Upload Youtube video(iframe)</h2>
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="about-company" class="form-label">Add youtube iframe</label>
                                        <textarea class="form-control" id="about-company" placeholder="" rows="3" name="youtube_iframe"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="each_box add_promotions">
                            <h2 class="mb-3">Add Promotions</h2>
                            <div class="repeter_wrap">
                                <div class="all_repeter">
                                    <div class="each_repeter">
                                        <div class="row align-items-center">
                                            <div class="col-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Add title<sup>*</sup></label>
                                                    <input type="text" class="form-control" placeholder="" name="promotion_title" required>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Add description<sup>*</sup></label>
                                                    <textarea class="form-control" placeholder="" rows="3" name="promotion_desc" ></textarea>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Add discount</label>
                                                    <input type="text" class="form-control" placeholder="In percentage (ex: 70%)" name="promotion_discount">
                                                </div>
                                            </div>
                                            <div class="col-sm-10">
                                                <label class="form-label">Upload image</label>
                                                <input class="form-control upload_in_repeter promotion_image" type="file" name="promotion_image">
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="display_image_box">
                                                    <img class="promotion_image_review" src="/front-end/images/fixed-emoji.png" alt="">
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="text-right"><button type="button" class="btn btn-danger delete_item">Remove</button></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="add_more_btn">
                                    <button type="button" class="btn btn-primary add_more_promotion">Add Promotion</button>
                                </div>
                            </div>
                        </div>
                        <div class="each_box add_products">
                            <h2 class="mb-3">Add Products</h2>
                            <div class="repeter_wrap">
                                <div class="all_repeter">
                                    <div class="each_repeter">
                                        <div class="row align-items-center">
                                            <div class="col-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Add title<sup>*</sup></label>
                                                    <input type="text" class="form-control" placeholder="" name="product_title" required>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Add description<sup>*</sup></label>
                                                    <textarea class="form-control" placeholder="" rows="3" name="product_desc"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-sm-10">
                                                <label class="form-label">Upload image</label>
                                                <input class="form-control upload_in_repeter product_image" type="file" name="product_image">
                                            </div>
                                            <div class="col-sm-2">
                                                <div class="display_image_box">
                                                    <img class="promotion_image_review" src="/front-end/images/fixed-emoji.png" alt="">
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="text-right"><button type="button" class="btn btn-danger delete_item">Remove</button></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="add_more_btn">
                                    <button type="button" class="btn btn-primary add_more_product">Add Product</button>
                                </div>
                            </div>
                        </div>
                        <div class="submit_button text-end custom-form m-0" >
                            <button type="submit" class="btn btn-warning ">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        <!-- ============== Section6 End =============== -->
        <%- include('common/footer') -%>

            <script>
                jQuery(function ($) {
                    $(document).ready(() => {

                        $('form#premium_company_profile_form').submit(function (e) {
                            e.preventDefault();
                            //alert('aaaaaa');
                            $('.basic-company-edit-message').hide();
                            $('.basic-company-edit-message').text('');
                            const formData = new FormData($('#premium_company_profile_form')[0])
                            //const formData = $('#premium_company_profile_form').serialize();
                            $('.product_image').each(function(index, element) {
                                const fileInput = element;
                                // Check if the file input has a selected file
                                if (fileInput.files.length === 0) {
                                    formData.set(`product_image[${index}]`, '');
                                }else{
                                    formData.set(`product_image[${index}]`, 'file');
                                }
                            });
                            $('.promotion_image').each(function(index, element) {
                                const fileInput = element;
                                // Check if the file input has a selected file
                                if (fileInput.files.length === 0) {
                                    // If no file is chosen, set the corresponding value to null
                                    formData.set(`promotion_image[${index}]`, '');
                                }else{
                                    formData.set(`promotion_image[${index}]`, 'file');
                                }
                            });
                            console.log(formData);
                            $.ajax({
                            url: '/auth/premium_company_profile_update', 
                            method: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (data) {
                                if (data.status == 'ok') {
                                    $('.basic-company-edit-message').text(data.message);
                                    $('.basic-company-edit-message').show();
                                    setTimeout(function() {
                                        window.location.href = "/basic-company-profile/" + data.data;
                                    }, 2000);
                                } else {
                                    $('.basic-company-edit-message').text(data.message);
                                    $('.basic-company-edit-message').show();
                                    console.log('Some thting went wrong');
                                }
                            },
                            error: function (xhr, status, error) {
                                // Handle any errors that occur during the request
                                console.log(error);
                            }
                            })
                        });

                        $('#upload-company-logo').change(function () {
                            const file = this.files[0];
                            console.log(file);
                            if (file) {
                                let reader = new FileReader();
                                reader.onload = function (event) {
                                    console.log(event.target.result);
                                    $('#company_logo_preview').attr('src', event.target.result);
                                }
                                reader.readAsDataURL(file);
                            }
                        });

                        $('#upload-company-coverimage').change(function () {
                            const file = this.files[0];
                            console.log(file);
                            if (file) {
                                let reader = new FileReader();
                                reader.onload = function (event) {
                                    console.log(event.target.result);
                                    $('#company_cover_image_preview').attr('src', event.target.result);
                                }
                                reader.readAsDataURL(file);
                            }
                        });

                        //============== Upload multiuple images\

                        $('#upload-gallery-img').on('change', function (e) {
                            var files = e.target.files;
                            var imagePreview = $('#imagePreview');

                            imagePreview.empty(); // Clear the preview before adding new images

                            for (var i = 0; i < files.length; i++) {
                                var file = files[i];
                                var reader = new FileReader();

                                reader.onload = function (e) {
                                    var imageUrl = e.target.result;
                                    var imageContainer = $('<div class="image-container col-sm-6 col-md-3">');
                                    var image = $('<img src="' + imageUrl + '" class="uploaded-image">');
                                    var deleteButton = $('<button class="delete-button">X</button>');

                                    deleteButton.on('click', function () {
                                        imageContainer.remove();
                                    });

                                    imageContainer.append(image, deleteButton);
                                    imagePreview.append(imageContainer);
                                }

                                reader.readAsDataURL(file);
                            }
                        });

                        //=============== Repeter js
                        $('body').on('change','.upload_in_repeter',function (event) {
                            var tmppath = URL.createObjectURL(event.target.files[0]);
                            $(this).parents('.each_repeter').find('.promotion_image_review').attr('src',tmppath);
                        });

                        $('.add_more_promotion').click(function(e){
                            $(this).parents('.add_promotions').find('.all_repeter').append('<div class=each_repeter><div class="align-items-center row"><div class=col-12><div class=mb-3><label class=form-label>Add title<sup>*</sup></label> <input class=form-control placeholder="" name="promotion_title" required></div></div><div class=col-12><div class=mb-3><label class=form-label>Add description<sup>*</sup></label> <textarea class=form-control placeholder="" name="promotion_desc" rows=3></textarea></div></div><div class=col-12><div class=mb-3><label class=form-label>Add discount</label> <input class=form-control placeholder="In percentage (ex: 70%)" name="promotion_discount" ></div></div><div class=col-sm-10><label class=form-label>Upload image</label> <input class="form-control upload_in_repeter promotion_image"type=file name="promotion_image"></div><div class=col-sm-2><div class=display_image_box><img alt=""class=promotion_image_review src=/front-end/images/fixed-emoji.png></div></div><div class=col-12><div class=text-right><button class="btn btn-danger delete_item"type=button>Remove</button></div></div></div></div>');
                        });

                        $('.add_more_product').click(function(e){
                            $(this).parents('.add_products').find('.all_repeter').append('<div class=each_repeter><div class="align-items-center row"><div class=col-12><div class=mb-3><label class=form-label>Add title<sup>*</sup></label> <input class=form-control placeholder="" name="product_title" required></div></div><div class=col-12><div class=mb-3><label class=form-label>Add description<sup>*</sup></label> <textarea class=form-control placeholder="" name="product_desc" rows=3></textarea></div></div><div class=col-sm-10><label class=form-label>Upload image</label> <input class="form-control upload_in_repeter product_image"type=file name="product_image" ></div><div class=col-sm-2><div class=display_image_box><img alt=""class=promotion_image_review src=/front-end/images/fixed-emoji.png></div></div><div class=col-12><div class=text-right><button class="btn btn-danger delete_item"type=button>Remove</button></div></div></div></div>');
                        });

                        $('body').on('click','.delete_item',function(){
                            $(this).parents('.each_repeter').remove();
                        });

                    });
                });
            </script>